<?php namespace ZN\DataTypes;
/**
 * ZN PHP Web Framework
 * 
 * "Simplicity is the ultimate sophistication." ~ Da Vinci
 * 
 * @package ZN
 * @license MIT [http://opensource.org/licenses/MIT]
 * @author  Ozan UYKUN [ozan@znframework.com]
 */

use Cookie, Session, Server, Autoloader;
use ZN\Helpers\Converter;

class Filters implements FiltersInterface
{
    //--------------------------------------------------------------------------------------------------------
    // Get
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $varName
    //
    //--------------------------------------------------------------------------------------------------------
    public function get(String $varName) : Bool
    {
        return (bool) ($_GET[$varName] ?? NULL);
    }

    //--------------------------------------------------------------------------------------------------------
    // Post
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $varName
    //
    //--------------------------------------------------------------------------------------------------------
    public function post(String $varName) : Bool
    {
        return (bool) ($_POST[$varName] ?? NULL);
    }

    //--------------------------------------------------------------------------------------------------------
    // Cookie
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $varName
    //
    //--------------------------------------------------------------------------------------------------------
    public function cookie(String $varName) : Bool
    {
        return (bool) (Cookie::select($varName) || ($_COOKIE[$varName] ?? NULL));
    }

    //--------------------------------------------------------------------------------------------------------
    // Session -> 5.3.1
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $varName
    //
    //--------------------------------------------------------------------------------------------------------
    public function session(String $varName) : Bool
    {
        return (bool) (Session::select($varName) || ($_SESSION[$varName] ?? NULL));
    }

    //--------------------------------------------------------------------------------------------------------
    // Env
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $varName
    //
    //--------------------------------------------------------------------------------------------------------
    public function env(String $varName) : Bool
    {
        return (bool) ($_ENV[$varName] ?? NULL);
    }

    //--------------------------------------------------------------------------------------------------------
    // Server
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $varName
    //
    //--------------------------------------------------------------------------------------------------------
    public function server(String $varName) : Bool
    {
        return (bool) (Server::data($varName) || ($_SERVER[$varName] ?? NULL));
    }

    //--------------------------------------------------------------------------------------------------------
    // ID
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $filterName
    //
    //--------------------------------------------------------------------------------------------------------
    public function id(String $filterName) : Int
    {
        return filter_id($filterName);
    }

    //--------------------------------------------------------------------------------------------------------
    // List
    //--------------------------------------------------------------------------------------------------------
    //
    // @param void
    //
    //--------------------------------------------------------------------------------------------------------
    public function list() : Array
    {
        return filter_list();
    }

    //--------------------------------------------------------------------------------------------------------
    // Input Array
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $type
    // @param mixed  $definition
    // @param bool   $addEmpty
    //
    //--------------------------------------------------------------------------------------------------------
    public function inputArray(String $type = 'post', $definition = NULL, Bool $addEmpty = true)
    {
        return filter_input_array($this->_inputConstant($type), $definition, $addEmpty);
    }

    //--------------------------------------------------------------------------------------------------------
    // Input
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $var
    // @param string $type
    // @param string $filter
    // @param mixed  $options
    //
    //--------------------------------------------------------------------------------------------------------
    public function input(String $var, String $type = 'post', String $filter = 'default' , $options = NULL)
    {
        return filter_input($this->_inputConstant($type), $var, $this->_filterConstant($filter), $options);
    }

    //--------------------------------------------------------------------------------------------------------
    // Var Array
    //--------------------------------------------------------------------------------------------------------
    //
    // @param array  $data
    // @param mixed  $definition
    // @param bool   $addEmpty
    //
    //--------------------------------------------------------------------------------------------------------
    public function varArray(Array $data, $definition = NULL, Bool $addEmpty = true)
    {
        return filter_var_array($data, $definition, $addEmpty);
    }

    //--------------------------------------------------------------------------------------------------------
    // Vars
    //--------------------------------------------------------------------------------------------------------
    //
    // @param mixed  $var
    // @param string $filter
    // @param mixed  $options
    //
    //--------------------------------------------------------------------------------------------------------
    public function var($var, String $filter = 'default', $options = NULL)
    {
        return filter_var($var, $this->_filterConstant($filter), $options);
    }

    //--------------------------------------------------------------------------------------------------------
    // Sanitize
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $const;
    //
    //--------------------------------------------------------------------------------------------------------
    public function sanitize(String $const)
    {
        return $this->_validate($const, __FUNCTION__);
    }

    //--------------------------------------------------------------------------------------------------------
    // Validate
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $const;
    //
    //--------------------------------------------------------------------------------------------------------
    public function validate(String $const)
    {
        return $this->_validate($const, __FUNCTION__);
    }

    //--------------------------------------------------------------------------------------------------------
    // Force
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $const;
    //
    //--------------------------------------------------------------------------------------------------------
    public function force(String $const)
    {
        return $this->_validate($const, __FUNCTION__);
    }

    //--------------------------------------------------------------------------------------------------------
    // Flag
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $const;
    //
    //--------------------------------------------------------------------------------------------------------
    public function flag(String $const)
    {
        return $this->_validate($const, __FUNCTION__);
    }

    //--------------------------------------------------------------------------------------------------------
    // Require
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $const;
    //
    //--------------------------------------------------------------------------------------------------------
    public function require(String $const)
    {
        return $this->_validate($const, 'require');
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected Var
    //--------------------------------------------------------------------------------------------------------
    protected function _var($varName = '', $type)
    {
        return filter_has_var($this->_inputConstant($type), $varName);
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected Input Constant
    //--------------------------------------------------------------------------------------------------------
    protected function _inputConstant($const)
    {
        return Converter::toConstant($const, 'INPUT_');
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected Filter Constant
    //--------------------------------------------------------------------------------------------------------
    protected function _filterConstant($const)
    {
        return Converter::toConstant($const, 'FILTER_');
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected Validate
    //--------------------------------------------------------------------------------------------------------
    protected function _validate($const, $type)
    {
        return constant('FILTER_'.Autoloader::upper($type).'_'.Autoloader::upper($const));
    }
}
